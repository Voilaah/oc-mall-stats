<div class="control-breadcrumb">
    <ul>
        <li><?= e(trans('voilaah.mallstats::lang.menu.statistics')) ?></li>
    </ul>
</div>

<?= $this->makePartial('~/plugins/offline/mall/controllers/orders/_orders_scoreboard.htm', ['stats' => $stats, 'money' => $money]); ?>

<?php
    $byMonth = $mallstats->ordersByMonth();
    $byMonthMaxCount = $byMonth['byMonthMaxCount'];
    $byMonthDataset = $byMonth['dataset'];

    $avgData = $mallstats->avgData();

    $customersByMonth = $mallstats->customersByMonth();
    $customersByMonthMaxCount = $customersByMonth['byMonthMaxCount'];
    $customersByMonthDataset = $customersByMonth['dataset'];
?>
<br>
<br>
<div class="scoreboard">
    <div data-control="toolbar">

        <div class="scoreboard-item title-value">
            <h4><?= e(trans('voilaah.mallstats::lang.titles.sales_average')) ?></h4>
            <p><?= e($money->format($avgData['avg_sales'])) ?></p>
            <p class="description"><?= e(trans('offline.mall::lang.common.since_begin')) ?></p>
        </div>

        <div class="scoreboard-item title-value">
            <h4><?= e(trans('voilaah.mallstats::lang.titles.nb_customers')) ?></h4>
            <p><?= $avgData['total_paid_customers'] ?> / <?= $avgData['total_customers'] ?></p>
            <p class="description"><?= e(trans('voilaah.mallstats::lang.titles.nb_customers_comment')) ?></p>
        </div>
    </div>

</div>

<div class="scoreboard statboard m-y">
    <br>
    <div class="row">
        <div class="col-md-4">
            <div class="statlistbox">
                    <br>
                    <strong><?= e(trans('voilaah.mallstats::lang.titles.best_sellers')) ?></strong>
                    <div class="clearfix"></div>
                    <br>
                    <?php foreach($mallstats->bestSellers() as $key => $product): ?>
                        <div class="col-md-1 col-sm-1"><?= $key+1 ?>.</div>
                        <div class="col-md-9 col-sm-9"><a href="<?= Backend::url('offline/mall/products/update/') ?>/<?= $product->id ?>"><?= $product->name ?></a></div>
                        <div class="text-right col-md-2 col-sm-2"><?= $product->sales_count ?></div>
                        <div class="clearfix"></div>
                    <?php endforeach; ?>
                    <br>
            </div>
        </div>
        <div class="col-md-4">

        </div>
        <div class="col-md-4">
        </div>
    </div>
    <br>
    <hr>
        <div class="title-value">
        <h4><?= e(trans('voilaah.mallstats::lang.titles.sales_period_month', ['year'=> date("Y")] )) ?></h4>
        </div>
        <br>
        <div class="row">
            <div class="col-md-3">
                <div class="statlistbox">

                    <br>
                    <?php foreach($byMonthDataset as $key => $value): ?>
                        <div class=" col-md-6 col-sm-6"><?= $value->monthname . ' ' . $value->year ?></div>
                        <div class="text-right col-md-6 col-sm-6"><?= $value->data ?></div>
                        <div class="clearfix"></div>
                    <?php endforeach; ?>
                    <br>
                </div>
            </div>

            <div class="col-md-9">

                <div
                    class="control-chart wrap-legend"
                    data-control="chart-bar"
                    data-height="<?= $byMonthMaxCount ?>"
                    data-full-width="1">
                    <ul>
                        <?php foreach($byMonthDataset as $key => $value): ?>
                            <li><?= $value->monthname . ' ' . $value->year ?> <span><?= $value->data ?></span></li>
                        <?php endforeach; ?>
                    </ul>
                </div>
            </div>

        </div>
        <br>
        <hr>
        <br>
        <div class="title-value">
            <h4><?= e(trans('voilaah.mallstats::lang.titles.nb_unique_customers_per_month', ['year'=> date("Y")] )) ?></h4>
        </div>
        <br>
        <div class="row">
            <div class="col-md-3">
                <div class="statlistbox">

                    <br>
                    <?php foreach($customersByMonthDataset as $key => $value): ?>
                        <div class=" col-md-6 col-sm-6"><?= $value->monthname . ' ' . $value->year ?></div>
                        <div class="text-right col-md-6 col-sm-6"><?= $value->data ?></div>
                        <div class="clearfix"></div>
                    <?php endforeach; ?>
                    <br>
                </div>
            </div>

            <div class="col-md-9">

                <div
                    class="control-chart wrap-legend"
                    data-control="chart-bar"
                    data-height="<?= $customersByMonthMaxCount ?>"
                    data-full-width="1">
                    <ul>
                        <?php foreach($customersByMonthDataset as $key => $value): ?>
                            <li><?= $value->monthname . ' ' . $value->year ?> <span><?= $value->data ?></span></li>
                        <?php endforeach; ?>
                    </ul>
                </div>
            </div>

        </div>
        <br>
        <hr>
        <br>
</div>
